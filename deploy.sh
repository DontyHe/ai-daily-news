#!/bin/bash

# AI Daily News - GitHubéƒ¨ç½²è„šæœ¬
# ä½¿ç”¨æ–¹æ³•: ./deploy.sh YOUR_GITHUB_TOKEN

set -e

# æ£€æŸ¥å‚æ•°
if [ -z "$1" ]; then
    echo "âŒ é”™è¯¯: è¯·æä¾›GitHub Personal Access Token"
    echo ""
    echo "ä½¿ç”¨æ–¹æ³•: ./deploy.sh YOUR_GITHUB_TOKEN"
    echo ""
    echo "åˆ›å»ºTokenæ­¥éª¤:"
    echo "1. è®¿é—® https://github.com/settings/tokens"
    echo "2. ç‚¹å‡» 'Generate new token (classic)'"
    echo "3. Note: 'AI Daily News Deployment'"
    echo "4. å‹¾é€‰: repo, workflow"
    echo "5. å¤åˆ¶tokenå¹¶è¿è¡Œè„šæœ¬"
    exit 1
fi

TOKEN=$1
REPO_NAME="ai-daily-news"
GITHUB_USER="dontyhe13"
EMAIL="dontyhe13@gmail.com"

echo "ğŸš€ å¼€å§‹éƒ¨ç½²AI Daily Newsåˆ°GitHub..."
echo "ğŸ“¦ ä»“åº“å: $REPO_NAME"
echo "ğŸ‘¤ ç”¨æˆ·: $GITHUB_USER"

# 1. æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–Git
if [ ! -d .git ]; then
    echo "ğŸ“ åˆå§‹åŒ–Gitä»“åº“..."
    git init
    git config user.name "$GITHUB_USER"
    git config user.email "$EMAIL"
else
    echo "âœ… Gitä»“åº“å·²å­˜åœ¨"
fi

# 2. åˆ‡æ¢åˆ°mainåˆ†æ”¯
echo "ğŸŒ¿ åˆ‡æ¢åˆ°mainåˆ†æ”¯..."
git branch -M main

# 3. åˆ›å»ºGitHubä»“åº“ï¼ˆä½¿ç”¨APIï¼‰
echo "ğŸ—ï¸ åˆ›å»ºGitHubä»“åº“..."

# æ£€æŸ¥ä»“åº“æ˜¯å¦å·²å­˜åœ¨
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
    -H "Authorization: token $TOKEN" \
    "https://api.github.com/repos/$GITHUB_USER/$REPO_NAME")

if [ "$RESPONSE" = "200" ]; then
    echo "âš ï¸ ä»“åº“ $REPO_NAME å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º"
else
    # åˆ›å»ºä»“åº“
    curl -s -X POST \
        -H "Authorization: token $TOKEN" \
        -H "Accept: application/vnd.github.v3+json" \
        -d "{\"name\":\"$REPO_NAME\",\"description\":\"AI Daily News - æ¯æ—¥AIæ–°é—»ç½‘ç«™\",\"private\":false,\"auto_init\":false}" \
        "https://api.github.com/user/repos"

    if [ $? -eq 0 ]; then
        echo "âœ… GitHubä»“åº“åˆ›å»ºæˆåŠŸ"
    else
        echo "âŒ åˆ›å»ºä»“åº“å¤±è´¥"
        exit 1
    fi
fi

# 4. æ·»åŠ è¿œç¨‹ä»“åº“
echo "ğŸ”— æ·»åŠ è¿œç¨‹ä»“åº“..."
git remote remove origin 2>/dev/null || true
git remote add origin "https://$GITHUB_USER:$TOKEN@github.com/$GITHUB_USER/$REPO_NAME.git"

# 5. æ·»åŠ å¹¶æäº¤æ–‡ä»¶
echo "ğŸ“¤ æäº¤æ–‡ä»¶..."
git add -A

# æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
if git diff --cached --quiet; then
    echo "âš ï¸ æ²¡æœ‰æ–°æ–‡ä»¶éœ€è¦æäº¤"
else
    echo "âœï¸ æäº¤æ›´æ”¹..."
    git commit -m "âœ¨ Initial commit: AI Daily News website

- ğŸ“° æ¯æ—¥AIæ–°é—»æ¨¡å—
- ğŸ“š æœ€æ–°è®ºæ–‡å±•ç¤º
- ğŸ› ï¸ AIå·¥å…·æ¨è
- ğŸ” æœç´¢å’Œç­›é€‰åŠŸèƒ½
- ğŸŒ™ æ·±è‰²æ¨¡å¼æ”¯æŒ
- ğŸ“± å“åº”å¼è®¾è®¡
- ğŸš€ Verceléƒ¨ç½²é…ç½®

ğŸ¤– Generated by javas"
fi

# 6. æ¨é€åˆ°GitHub
echo "ğŸš€ æ¨é€åˆ°GitHub..."
git push -u origin main

# 7. å®Œæˆ
echo ""
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo ""
echo "ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ:"
echo "1. è®¿é—® https://vercel.com/new"
echo "2. é€‰æ‹©å¯¼å…¥ '$REPO_NAME' ä»“åº“"
echo "3. ç‚¹å‡» 'Deploy' è‡ªåŠ¨éƒ¨ç½²"
echo ""
echo "ğŸŒ éƒ¨ç½²æˆåŠŸåè®¿é—®:"
echo "   https://dontyhe13.github.io/$REPO_NAME"
echo "   æˆ–"
echo "   https://$REPO_NAME.vercel.app"
echo ""
echo "ğŸˆâ€â¬› æ­å–œï¼AI Daily Newså·²ä¸Šçº¿ï¼"
